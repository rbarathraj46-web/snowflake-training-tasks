CREATE OR REPLACE WAREHOUSE LOGS_WH
WITH
    WAREHOUSE_SIZE = 'XSMALL'
    AUTO_SUSPEND = 60
    AUTO_RESUME = TRUE;
USE WAREHOUSE LOGS_WH;

CREATE OR REPLACE DATABASE LOG_ANALYTICS_DB;
USE DATABASE LOG_ANALYTICS_DB;

CREATE OR REPLACE SCHEMA PUBLIC;
USE SCHEMA PUBLIC;

USE ROLE SYSADMIN;

CREATE OR REPLACE TABLE APPLICATION_LOGS (
    EVENT_ID STRING,
    EVENT_TIME TIMESTAMP,
    SERVICE_NAME STRING,
    LOG_LEVEL STRING,
    USER_ID STRING,
    API_ENDPOINT STRING,
    RESPONSE_TIME_MS INTEGER,
    ERROR_MESSAGE STRING,
    REGION STRING,
    ERROR_FLAG STRING
);

SELECT * FROM APPLICATION_LOGS LIMIT 10;

SELECT service_name, COUNT(*) AS error_count
FROM APPLICATION_LOGS
WHERE error_flag = 'Y'
GROUP BY service_name;
