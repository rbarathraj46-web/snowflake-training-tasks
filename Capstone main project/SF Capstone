USE ROLE ACCOUNTADMIN;

CREATE OR REPLACE WAREHOUSE RETAIL_WH
WAREHOUSE_SIZE = SMALL
AUTO_SUSPEND = 60
AUTO_RESUME = TRUE;

CREATE OR REPLACE DATABASE RETAIL_DB;
USE DATABASE RETAIL_DB;

CREATE OR REPLACE SCHEMA RAW;
CREATE OR REPLACE SCHEMA CURATED;
CREATE OR REPLACE SCHEMA ANALYTICS;


CREATE OR REPLACE ROLE RAW_ROLE;
CREATE OR REPLACE ROLE TRANSFORM_ROLE;
CREATE OR REPLACE ROLE ANALYTICS_ROLE;

GRANT ROLE RAW_ROLE TO ROLE TRANSFORM_ROLE;
GRANT ROLE TRANSFORM_ROLE TO ROLE ANALYTICS_ROLE;

GRANT ROLE ANALYTICS_ROLE TO USER BARATH46;

GRANT USAGE ON WAREHOUSE RETAIL_WH TO ROLE ANALYTICS_ROLE;
GRANT USAGE ON DATABASE RETAIL_DB TO ROLE ANALYTICS_ROLE;
GRANT USAGE ON SCHEMA RAW TO ROLE ANALYTICS_ROLE;
GRANT USAGE ON SCHEMA CURATED TO ROLE ANALYTICS_ROLE;
GRANT USAGE ON SCHEMA ANALYTICS TO ROLE ANALYTICS_ROLE;

GRANT ALL ON SCHEMA RAW TO ROLE ANALYTICS_ROLE;
GRANT ALL ON SCHEMA CURATED TO ROLE ANALYTICS_ROLE;
GRANT ALL ON SCHEMA ANALYTICS TO ROLE ANALYTICS_ROLE;

USE ROLE ANALYTICS_ROLE;
USE SCHEMA RAW;

CREATE OR REPLACE TABLE RAW_CUSTOMERS (
    customer_id INT,
    first_name STRING,
    last_name STRING,
    email STRING,
    city STRING,
    created_date DATE
);

CREATE OR REPLACE TABLE RAW_ORDERS (
    order_id INT,
    customer_id INT,
    order_date DATE,
    order_amount NUMBER,
    order_status STRING
);

CREATE OR REPLACE TABLE RAW_PAYMENTS (
    payment_id STRING,
    order_id INT,
    payment_date DATE,
    payment_mode STRING,
    payment_amount NUMBER
);

SELECT * FROM ANALYTICS.CUSTOMER_SALES_SUMMARY;
