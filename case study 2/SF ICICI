CREATE OR REPLACE WAREHOUSE ICICI_WH
WITH
    WAREHOUSE_SIZE = 'XSMALL' 
    AUTO_SUSPEND = 300          
    AUTO_RESUME = TRUE;

USE WAREHOUSE ICICI_WH;

CREATE OR REPLACE DATABASE ICICI_DB;

CREATE OR REPLACE SCHEMA ICICI_DB.PUBLIC;

-- Use the database and schema
USE DATABASE ICICI_DB;
USE SCHEMA PUBLIC;

SHOW ROLES;
USE ROLE SYSADMIN;

GRANT USAGE ON DATABASE ICICI_DB TO ROLE SYSADMIN;
GRANT USAGE ON SCHEMA ICICI_DB.PUBLIC TO ROLE SYSADMIN;
GRANT CREATE TABLE ON SCHEMA ICICI_DB.PUBLIC TO ROLE SYSADMIN;
GRANT INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA ICICI_DB.PUBLIC TO ROLE SYSADMIN;
GRANT CREATE TABLE ON FUTURE SCHEMAS IN DATABASE ICICI_DB TO ROLE SYSADMIN;
GRANT INSERT, UPDATE, DELETE ON FUTURE TABLES IN SCHEMA ICICI_DB.PUBLIC TO ROLE SYSADMIN;

SELECT
    insurance_type,
    region,
    SUM(claim_amount) AS total_approved_claim_amount
FROM ICICI_APPROVED_CLAIMS
GROUP BY insurance_type, region;
